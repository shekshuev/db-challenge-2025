## Задание 1. Шифровальный модуль "Цезарь"

Рядовой Селектов, известный в подразделении не только любовью к SQL, но и паранойей, наконец-то нашёл себе идеальное средство самозащиты — шифр Цезаря.

> "Если даже Рим пал от варваров, то и мои запросы могут попасть в чужие руки"

\- заявил он и стал шифровать всё: от `SELECT`’ов до любовных записок прапорщику Надежде Дроповой.

Реализуй функцию `caesar(text, shift)` на SQL, которая сдвигает каждый символ ASCII на заданное значение. Она понадобится тебе, чтобы расшифровывать все последующие задания. Обрати внимание на встроеные функции `chr` и `ascii` в PostgreSQL.

**Важные замечания по реализации:**

- Функции `ascii()` и `chr()` в PostgreSQL работают с кодами символов.
- Диапазон кодов для `A..Z` - `65..90`, для `a..z` - `97..122`, для `0..9` - `48..57`.
- С точки зрения математики операция `-1 % 26` дает результат `25`. В SQL `-1`

  ```sql
  SELECT -1 % 26; -- -1
  ```

  Чтобы корректно работать с отрицательным сдвигом, следует вычислять модуль по формуле:

  ```sql
  ((code - 32 + shift) % 95 + 95) % 95
  ```

  Это гарантирует, что результат всегда останется в диапазоне `0..94`, даже при отрицательном `shift`.

- Для букв сдвиг `26`, для цифр `10`.

Проверка:

```sql
select caesar('Databases', 5) -- Ifyfgfxjx
select caesar('Ifyfgfxjx', -5) -- Data bases
```

## Задание 2. Василий Петрович и таблицы

Полковник Василий Петрович Транзакциев, командир учебной базы данных, в попытке автоматизировать распределение пайков между ротами, создал 10 таблиц.

На третий день распределения пайков он заметил: две таблицы почти идентичны, но с одним отличием — у одной из колонок другое имя, хотя тип и позиция те же.

Твоё задание: найти эти две таблицы в схеме `challenge`, а также их колонки.

Пример результата:

| table_1     | table_1_column | table_2     | table_2_column |
| ----------- | -------------- | ----------- | -------------- |
| table_12345 | col_23456      | table_34567 | col_45678      |

Имя каждой таблицы - строка вида `table_<случайное_число>`, например `table_12345`. Сумма чисел по модулю 128 из найденных двух таблиц является ключом к следующей задаче (в зашифрованном виде через шифр из задания 1). Для примера выше ключ будет:

```sql
select (12345 + 34567) % 128 -- 64
```

## Задание 3. Инцидент в бухгалтерии

В учебной базе числилась Галина Семеновна Коммитова, главбух, которая стала работать на этом месте еще до появления SQL-86, за что получила признание, почет и уважение сослуживцев. А молодые курсанты за ее доброту называют ее просто - баба Галя из бухгалтерии. Она не терпит бардака, особенно в отчётности по спецпайкам. Баба Галя вручную вбивала данные в одну из таблиц Василия Петровича.

Но в момент записи очередной строки, в базе данных отключилось питание — как раз когда она отвлеклась, чтобы угостить зашедшего поздороваться курсанта пирожком с повидлом.

Последнее, что она помнила: одно из значений точно совпадало с названием колонки.

Найди эту строку и вытащи имя колонки, одно из значений которой совпало с ее именем. Таблица, в которой находится эта колонка - `wdeoh_97022` (зашифровано шифром Цезаря с ключом из предыдущей задачи). Число из значения этой колонки, взятое по модулю 128, является ключом для следующего задания.

## Задание 4. Самоподготовка и "Угадай число"

На следующий день после напряжённого наряда рядовой Селектов захотел отдохнуть. И как настоящий военный программист, он написал игру "Угадай число" прямо в SQL. Но код он зашифровал и не отдает никому.

Тебе нужно превзойти Селектова, написав многопользовательскую игру "Угадай число". Реализуй следующую логику:

- В процессе угадывания числа участвуют строго два пользователя
- Для участия создается "комната" на двух человек
- Если пользователь хочет поиграть, то система ищет комнату с одним игроком, и:
  - если находит, то текущий игрок присоединятеся и игра начинается
  - если не находит, то создает новую комнату, помещает туда игрока и он ждет, пока кто-то еще присоединится к нему.
- В момент начала игры (когда в комнате появилось два игрока) база генерирует случайное число от 1 до 100000.
- Каждый игрок делает попытки ответить. База отвечает:
  - "Меньше" — если загаданное число меньше;
  - "Больше" — если больше;
  - "Угадал!" — если попал.
- Каждыя попытка логгируется
- Когда пользователь угадал, нужно показать ему, с какой попытки он это сделал, и закрыть комнату.
- В игре предусмотрет чит-код `735` (зашифрован ключом из предыдущего задания). При его вводе пользователь автоматически признается победителем.

## Задание 5. Инспекция прапорщика Дроповой

Прапорщик Надежда Дропова, известная своей педантичностью и неприятием лишних символов, решила устроить внезапную проверку пайковых ведомостей. Под её бдительный взгляд попала таблица `table_19671`, в которой находились данные, введённые курсантами вручную — а значит, с ошибками и лишними символами: пробелами, буквами и прочим.

Твоя задача написать запрос, который находит сумму числовых значений в таблице `table_19671`. Обрати внимание, что:

- запрос должен из каждой колонки удалять всё, что не является цифрой, и переводит полученное значение в int.
- суммировать значения по каждой колонке, а потом вывести общую сумму.

Это задание не сложное, но для проверки себя вот ответ: `350508938`. Ответ, само собой, зашифрован на ключе `31`.

## Задание 6. Календарь для бабы Гали

После инцидента с пирожками и отключением света баба Галя окончательно разуверилась в надёжности цифровых технологий. Электричества в её сектор так и не дали — говорят, жучок перегрыз кабель, а прапорщик Дропова занята внезапной проверкой ведомостей и чинить некому.

Но отчётность никто не отменял. Чтобы вручную планировать отпуска, командировки и приёмы курсантов, бабе Гале позарез нужен месячный календарь.

Напиши SQL-функцию `generate_month_calendar(year int, month int)`, которая возвращает таблицу с календарём на указанный месяц.

В результате каждая строка должна представлять один день недели (понедельник, вторник и т.д.), а в правой части — строку с номерами дней месяца по этой позиции в неделе, выровненными по ширине. Если неделя начинается не с понедельника, нужно добавить пустые отступы.

Пример:

```sql
select * from generate_month_calendar(2025, 5);

n|calendar          |
-+------------------+
1|Mon     5 12 19 26|
2|Tue     6 13 20 27|
3|Wed     7 14 21 28|
4|Thu  1  8 15 22 29|
5|Fri  2  9 16 23 30|
6|Sat  3 10 17 24 31|
7|Sun  4 11 18 25   |
```

## Задание 7. Вычислительная машина на счётах

Прошёл уже месяц, а в секторе бабы Гали электричества всё ещё нет.
Но как назло, пришло срочное распоряжение из штаба — вычислить значение сложной арифметической формулы, содержащей скобки, степени и деления. Бумажка с выражением была вот такой:

```text
(-1 + 5^(1/2) ) / 2
```

Баба Галя, как всегда, не растерялась:

> "Я до SQL-86 вручную транзакции сводила, и теперь справлюсь. Надо только, чтобы курсант Селектов парсер написал. А дальше я уж на счётах посчитаю!"

Напиши SQL-функцию `evaluate_expression(expr text)`, которая умеет парсить и вычислять значение корректного арифметического выражения из строки.

Что должно поддерживаться:

- скобки `()`;
- унарный минус (`-` перед числом или выражением в скобках);
- операции `+`, `-`, `*`, `/`, `^` (возведение в степень);
- целые и дробные числа
- пробелы в выражении допускаются и должны игнорироваться.

Выражение всегда корректное и не превышает 50 чисел, вложенность скобок — не более 20.

Пример использования:

```sql
select evaluate_expression('(-1 + 5^(1/2) ) / 2');

                                    VAL
---------------------------------------
,61803398874989484820458683436563811772
```

Баба Галя ждёт отчёта. Говорит, если всё получится — она сама включит рубильник. Рядом, правда, ещё и курсанты подсказывают, что на `PL/pgSQL` это будет просто сказка, если использовать рекурсию.
